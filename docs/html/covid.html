<!DOCTYPE html>
<html>
    <head>
        <title>Daily Covid cases</title>
        <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
        <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3-fetch@3"></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdn.flourish.rocks/flourish-live-v4.min.js"></script>
        <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="../css/mobile.css">
        <link rel="stylesheet" type="text/css" href="../css/covid.css">
        <script src="https://use.fontawesome.com/c52f80daea.js"></script>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">

    </head>

    <body>
      <div class="nav" style="padding: 1px 8px;">
        <a href="../index.html"><i class="fas fa-home" style='font-size:28px; color:#777;'></i></a>
      </div>
      <div class="column content">
        <div class="heading">
          <h1>Coronavirus cases, deaths and vaccinations today in England</h1>
          <div class="teaser">
            <p>The latest daily updates on coronavirus cases, deaths and vaccinations in England.</p>
          </div>
            <div class="byline">By Vanessa Fillis, 3 November 2021</div> 
        </div>

        <div class="text" style="color: #111;">
          <h2>Daily confirmed coronavirus cases by date reported</h2>
          <!-- <p>X people have tested positive for Covid-19 on.</p> -->
          <p>Select time period: 
            <button id="full-data-cases">All</button>
            <button id="last-year-cases">One year</button> 
            <button id="last-6-months-cases">Last six months</button> 
            <button id="last-3-months-cases">Last three months</button> 
            <button id="latest-month-cases">Last month</button> 
          </p>
        </div>
        
        <div id="chartCovidCases"></div>
        
        <div class="text" style="color: #111;">
          <h2>Coronavirus deaths per day</h2>
          <p>Select time period: 
            <button id="full-data-deaths">All</button>
            <button id="last-year-deaths">One year</button> 
            <button id="last-6-months-deaths">Last six months</button> 
            <button id="last-3-months-deaths">Last three months</button> 
            <button id="latest-month-deaths">Last month</button> 
          </p>
        </div>
          <div id="chartCovidDeaths"></div>

        <div class="text" style="color: #111;">
          <h2>Coronavirus vaccinations</h2>
          <p>Select time period: 
            <button id="full-data-vaccinations">All</button>
            <!-- <button id="last-year-vaccinations">One year</button>  -->
            <button id="last-6-months-vaccinations">Last six months</button> 
            <button id="last-3-months-vaccinations">Last three months</button> 
            <button id="latest-month-vaccinations">Last month</button> 
          </p>
        </div>
        <div id="chartCovidVaccinations"></div>

        <div class="text" style="color: #111;">
          <h2>Vaccinations in age groups</h2>
        </div>
        <div id="chartCovidVaccinationsAges"></div>

        <!-- <div class="text" style="color: #111;">
          <h2>Find coronavirus cases near you</h2>
          <p>The following table shows the number of cases in the last seven days per 100,000 people. It also compares the figure to the previous seven days and states whether cases have increased or decreased.</p>
        </div>
        <div id="chartCovidCasesTable"></div> -->

        <!-- <div class="text" style="color: #111;">
          <h2>Coronavirus hospitalisations per day</h2>
          <p>Select time period: 
            <button id="full-data-hospital">All</button>
            <button id="last-year-hospital">One year</button> 
            <button id="last-6-months-hospital">Last six months</button> 
            <button id="last-3-months-hospital">Last three months</button> 
            <button id="latest-month-hospital">Last month</button> 
          </p>
        </div> -->

        <div class="text" style="color: #111;">
          <h2>About the data</h2>
          <p>The data comes from <a href="https://coronavirus.data.gov.uk/">Public Health England</a>.</p>
          <p>The scripts that are analysing the data are run daily and will automatically update these charts.</p>
          <p>The charts are built with Flourish. </p>

      </div>

      <script>
        // dates 
        var d = new Date();
        var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
        const month = ["January","February","March","April","May","June","July","August","September","October","November","December"];
        var todayFormatted = (d.getDate()-1)+' '+month[d.getMonth()]+' '+d.getFullYear();
          
        // covid cases
          d3.csv("https://raw.githubusercontent.com/vfillis/automated-covid/main/data/cases-England.csv").then(function(raw_data){
          // var buttonAll = document.createElement("button");
          // buttonAll.innerHTML = "All";
          // buttonAll.id = "full-data-cases";
          // console.log(buttonAll);
          var my_visualisation = new Flourish.Live({
            "template": "@flourish/line-bar-pie",
            "version": "22.1.0",
            "api_key": "FGCFFotq1s0aECvKcS6rilvdJBCgAHgG-jRUsR9uFznEbEodBBws9Niphbd3z93b",
            "container": "#chartCovidCases",
            "private": false,
            // "height": "180%",
            "state": {
                "chart_type": "column_stacked_line",
                "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                  "#1e8fcc",
                  "#b3325d",
                  "#ff75a3",
                  "#aecc70",
                  "#f34d5b",
                  "#d9ccc3"
                ],
                "sequential_palette": "Custom",
                "sequential_custom_min": "#e0e7f0",
                "sequential_custom_max": "#0d7faf",
                "diverging_palette": "Custom",
                "diverging_custom_min": "#df070a",
                "diverging_custom_max": "#15be09",
                },
                "column_opacity": 1,
                "column_padding_inner": 20,
                "column_padding_stack": 0.3,
                "datetime_input_format": "%Y-%m-%d",
                "dot_mode": "off",
                "dot_radius": 0.01,
                "dot_radius_last": 100000,
                "dual_axis": false,
                "facet_layout": "single",
                "facets": {
                "title_color": null
                },
                "height_mode": "auto",
                "label_data_type": "auto",
                "layout": {
                "background_color": "#fdfdfd",
                "body_font": {
                "name": "Roboto Condensed",
                "url": "https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700"
                },
                "border": {
                    "enabled": false,
                    "top": {
                    "width": 3,
                    "color": "#686868"
                    },
                    "right": {
                    "width": 0
                    },
                    "bottom": {
                    "width": 0
                    },
                    "left": {
                    "width": 0
                    }
                },
                "font_color": "#404040",
                "title_size": "custom",
                "title_size_custom": 1.5,
                "subtitle_size": "custom",
                "subtitle_size_custom": 1.25,
                "header_text_size": "custom",
                "header_text_size_custom": 1.1,
                "header_text_line_height": 1.15,
                "footer_note": "Last updated: " + todayFormatted,
                "footer_note_secondary": "<b>Chart credit:</b> Vanessa Fillis",
                "source_label": "<b>Data source: </b>",
                "source_name": "data.gov.uk",
                "source_url": "https://coronavirus.data.gov.uk/",
                "footer_text_size": 0.9,
                "footer_logo_height": 2
                },
                "legend_categorical": {
                "order_override": "Daily cases by date reported\nSeven-day average",
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "legend_show": "false",
                "line_width": 0.2,
                "number_format": {
                "advanced": true,
                "n_dec": 0,
                "strip_separator": false
                },
                "popup": {
                "is_custom": false,
                "style_popups": true
                },
                "stack_labels": false,
                "text_legend": "off",
                "x_axis_date_format": "%d-%b-%y",
                "x": {
                "datetime_max": today,
                "datetime_min": "2020-02-17",
                "flip": false,
                "show_scale_settings": false,
                "tick_label_styling": true,
                "tick_mode": "number",
                "tick_label_color": "#777777",
                "tick_label_angle": 0
                },
                "y": {
                "tick_label_styling": true,
                "tick_mode": "number",
                "tick_label_color": "#777777"
                },
                "legend_continuous": {
                "color_band_height": 3,
                "color_band_radius": 1
                },
                "legend_categorical_points": {
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "legend_categorical_map": {
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "legend_continuous_points": {
                "color_band_height": 3,
                "color_band_radius": 1
                },
                "legend_continuous_map": {
                "color_band_height": 3,
                "color_band_radius": 1
                }
            },
            "bindings": {
                "data": {
                "label": "date",
                "value": [
                    "Seven-day average",
                    "Daily cases by date reported"
                ],
                // "metadata": [
                //     "date", 
                //     "Seven-day average",
                //     "Daily cases by date reported"
                // ]
                }
            },
            "data": {
              data: raw_data
            },
});

  // latest month
	document.getElementById("latest-month-cases").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    var todayMinusOneMonth = d.getFullYear()+'-'+(d.getMonth())+'-'+(d.getDate()-1);
    // console.log(today);
    // console.log(todayMinusOneMonth);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": todayMinusOneMonth
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  })

  // last 3 months
  document.getElementById("last-3-months-cases").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    var todayMinusThreeMonths = (d.getFullYear()-1)+'-'+(d.getMonth()+10)+'-'+(d.getDate()-1);
    // console.log(today);
    // console.log(todayMinusThreeMonths);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": todayMinusThreeMonths
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  }) 

  // last 6 months
  document.getElementById("last-6-months-cases").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    var todayMinusSixMonths = (d.getFullYear()-1)+'-'+(d.getMonth()+7)+'-'+(d.getDate()-1);
    // console.log(today);
    // console.log(todayMinusSixMonths);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": todayMinusSixMonths
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  }) 

  // last year
  document.getElementById("last-year-cases").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    var todayMinusOneYear = (d.getFullYear()-1)+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    // console.log(today);
    // console.log(todayMinusOneYear);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": todayMinusOneYear
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  })

  // all 
  document.getElementById("full-data-cases").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": "2020-02-17"
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  })  

});

          // covid deaths 
          d3.csv("https://raw.githubusercontent.com/vfillis/automated-covid/main/data/deaths-England.csv").then(function(raw_data){
            var my_visualisation = new Flourish.Live({
            "template": "@flourish/line-bar-pie",
            "version": "22.1.0",
            "api_key": "FGCFFotq1s0aECvKcS6rilvdJBCgAHgG-jRUsR9uFznEbEodBBws9Niphbd3z93b",
            "container": "#chartCovidDeaths",
            "private": false,
            // "height": "180%",
            "state": {
                "chart_type": "column_stacked_line",
                "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                  "#1e8fcc",
                  "#b3325d",
                  "#ff75a3",
                  "#aecc70",
                  "#f34d5b",
                  "#d9ccc3"
                ],
                "sequential_palette": "Custom",
                "sequential_custom_min": "#e0e7f0",
                "sequential_custom_max": "#0d7faf",
                "diverging_palette": "Custom",
                "diverging_custom_min": "#df070a",
                "diverging_custom_max": "#15be09",
                },
                "column_opacity": 1,
                "column_padding_inner": 20,
                "column_padding_stack": 0.3,
                "datetime_input_format": "%Y-%m-%d",
                "dot_mode": "off",
                "dot_radius": 0.01,
                "dot_radius_last": 100000,
                "dual_axis": false,
                "facet_layout": "single",
                "facets": {
                "title_color": null
                },
                "height_mode": "auto",
                "label_data_type": "auto",
                "layout": {
                "background_color": "#fdfdfd",
                "margin_top": 0,
                "body_font": {
                "name": "Roboto Condensed",
                "url": "https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700"
                },
                "border": {
                    "enabled": false,
                    "top": {
                    "width": 3,
                    "color": "#686868"
                    },
                    "right": {
                    "width": 0
                    },
                    "bottom": {
                    "width": 0
                    },
                    "left": {
                    "width": 0
                    }
                },
                "font_color": "#404040",
                "title_size": "custom",
                "title_size_custom": 1.5,
                "subtitle_size": "custom",
                "subtitle_size_custom": 1.25,
                "header_text_size": "custom",
                "header_text_size_custom": 1.1,
                "header_text_line_height": 1.15,
                "footer_text_size": 0.9,
                "footer_note": "Last updated: " + todayFormatted,
                "footer_note_secondary": "<b>Chart credit:</b> Vanessa Fillis <br>People who have died within 28 days of their first positive test for coronavirus. Deaths assigned to the date they are reported. Line shows daily average in a given week.",
                "source_label": "<b>Data source: </b>",
                "source_name": "data.gov.uk",
                "source_url": "https://coronavirus.data.gov.uk/details/cases",
                "footer_logo_height": 2
                },
                "legend_categorical": {
                "order_override": "Daily deaths by date reported\nSeven-day average",
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "legend_show": "false",
                "line_width": 0.2,
                "number_format": {
                "advanced": true,
                "n_dec": 0,
                "strip_separator": false
                },
                "popup": {
                "is_custom": false,
                "style_popups": true
                },
                "stack_labels": false,
                "text_legend": "off",
                "x_axis_date_format": "%d-%b-%y",
                "x": {
                "datetime_max": today,
                "datetime_min": "2020-02-17",
                "flip": false,
                "show_scale_settings": false,
                "tick_label_styling": true,
                "tick_mode": "number",
                "tick_label_color": "#777777",
                "tick_label_angle": 0
                },
                "y": {
                "tick_label_styling": true,
                "tick_mode": "number",
                "tick_label_color": "#777777"
                },
                "legend_continuous": {
                "color_band_height": 3,
                "color_band_radius": 1
                },
                "legend_categorical_points": {
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "legend_categorical_map": {
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "legend_continuous_points": {
                "color_band_height": 3,
                "color_band_radius": 1
                },
                "legend_continuous_map": {
                "color_band_height": 3,
                "color_band_radius": 1
                }
            },
            "bindings": {
                "data": {
                "label": "date",
                "value": [
                    "Seven-day average",
                    "Daily deaths by date reported"
                ],
                // "metadata": [
                //     "date", 
                //     "Seven-day average",
                //     "Daily cases by date reported"
                // ]
                }
            },
            "data": {
              data: raw_data
            },
});

  // latest month
	document.getElementById("latest-month-deaths").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    var todayMinusOneMonth = d.getFullYear()+'-'+(d.getMonth())+'-'+(d.getDate()-1);
    console.log(raw_data);
    console.log(d3.max(raw_data, function(raw_data) { return raw_data['Daily deaths by date reported']; }));
    // console.log(today);
    // console.log(todayMinusOneMonth);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": todayMinusOneMonth
          },
          "y": {
            "linear_max": 400,
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  })

  // last 3 months
  document.getElementById("last-3-months-deaths").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    var todayMinusThreeMonths = (d.getFullYear()-1)+'-'+(d.getMonth()+10)+'-'+(d.getDate()-1);
    // console.log(today);
    // console.log(todayMinusThreeMonths);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": todayMinusThreeMonths
          },
          "y": {
            "linear_max": 400,
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  }) 

  // last 6 months
  document.getElementById("last-6-months-deaths").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    var todayMinusSixMonths = (d.getFullYear()-1)+'-'+(d.getMonth()+7)+'-'+(d.getDate()-1);
    // console.log(today);
    // console.log(todayMinusSixMonths);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": todayMinusSixMonths
          },
          "y": {
            "linear_max": 400,
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  }) 

  // last year
  document.getElementById("last-year-deaths").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    var todayMinusOneYear = (d.getFullYear()-1)+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
    // console.log(today);
    // console.log(todayMinusOneYear);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": todayMinusOneYear
          },
          "y": {
            "linear_max": 1700,
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  })

  // all 
  document.getElementById("full-data-deaths").addEventListener('click', function () {
    var d = new Date();
    var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);

    my_visualisation.update({
        state: {
          "x": {
            "datetime_max": today,
            "datetime_min": "2020-02-17"
          },
          "y": {
            "linear_max": 1700,
          },
          "color": {
                "categorical_palette": [
                  "#1e558c",
                  "#94d2e6",
                ],
          }
        }
    });
  })  

});

          // covid vaccinations total 
          d3.csv("https://raw.githubusercontent.com/vfillis/automated-covid/main/data/vaccinations-England.csv").then(function(raw_data){
          var my_visualisation = new Flourish.Live({
            "template": "@flourish/line-bar-pie",
            "version": "22.1.0",
            "api_key": "FGCFFotq1s0aECvKcS6rilvdJBCgAHgG-jRUsR9uFznEbEodBBws9Niphbd3z93b",
            "container": "#chartCovidVaccinations",
            "private": false,
            "state": {
              "chart_type": "column_stacked",
              "color": {
              "categorical_palette": [
              "#1e558c",
              "#94d2e6",
              "#1e8fcc",
              "#b3325d",
              "#ff75a3",
              "#aecc70",
              "#f34d5b",
              "#d9ccc3"
              ],
              "sequential_palette": "Custom",
              "sequential_custom_min": "#e0e7f0",
              "sequential_custom_max": "#0d7faf",
              "diverging_palette": "Custom",
              "diverging_custom_min": "#df070a",
              "diverging_custom_max": "#15be09",
              },
              "column_opacity": 1,
              "column_padding_inner": 20,
              "column_padding_stack": 0.3,
              "datetime_input_format": "auto",
              "dot_mode": "off",
              "dot_radius": 0.01,
              "dot_radius_last": 100000,
              "dual_axis": false,
              "facet_layout": "single",
              "facets": {
              "title_color": null
              },
              "height_mode": "fill_space",
              "label_data_type": "auto",
              "layout": {
              "background_color": "#fdfdfd",
              "body_font": {
              "name": "Roboto Condensed",
              "url": "https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700"
              },
              "footer_note": "Last updated: " + todayFormatted,
              "footer_note_secondary": "<b>Chart credit:</b> Vanessa Fillis",
              "source_label": "<b>Data source: </b>",
              "source_name": "data.gov.uk",
              "source_url": "https://coronavirus.data.gov.uk/",
              "title": "",
              "subtitle_font": {
              "name": "Source Sans Pro",
              "url": "https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700"
              },
              "border": {
              "enabled": false,
              "top": {
              "width": 3,
              "color": "#686868"
              },
              "right": {
              "width": 0
              },
              "bottom": {
              "width": 0
              },
              "left": {
              "width": 0
              }
              },
              "font_color": "#404040",
              "title_size": "custom",
              "title_size_custom": 1.5,
              "subtitle_size": "custom",
              "subtitle_size_custom": 1.25,
              "header_text_size": "custom",
              "header_text_size_custom": 1.1,
              "header_text_line_height": 1.15,
              "footer_text_size": 0.9,
              "footer_logo_height": 2
              },
              "legend_categorical": {
              "order_override": "",
              "orientation": "horizontal",
              "swatch_height": 0.8,
              "swatch_radius": 2,
              "swatch_width": 0.9
              },
              "legend_mode": "on",
              "legend_position": "above",
              "legend_show": "false",
              "line_width": 0.2,
              "number_format": {
              "advanced": true,
              "n_dec": 0,
              "strip_separator": false
              },
              "popup": {
              "custom_template": "<h1 style=\"\">{{date}} </h1>\nDaily cases by date reported: {{Daily cases by date reported}} <br>\nSeven-day average: {{Seven-day average}}",
              "is_custom": false,
              "style_popups": true
              },
              "series_filter_mode": "none",
              "stack_labels": false,
              "text_legend": "off",
              "x_axis_date_format": "%b %y",
              "x": {
              "datetime_max": today,
              "datetime_min": "2021-01-11",
              "flip": false,
              "show_scale_settings": false,
              "tick_label_styling": true,
              "tick_mode": "number",
              "tick_number": 5,
              "tick_label_color": "#777777"
              },
              "y": {
              "linear_max": null,
              "nice": true,
              "show_scale_settings": false,
              "tick_label_styling": true,
              "tick_mode": "number",
              "tick_label_color": "#777777"
              },
              "legend_continuous": {
              "color_band_height": 3,
              "color_band_radius": 1
              },
              "colors": {
              "sequential_palette": "Custom",
              "sequential_custom_min": "#e0e7f0",
              "sequential_custom_max": "#0d7faf",
              "diverging_palette": "Custom",
              "diverging_custom_min": "#df070a",
              "diverging_custom_max": "#15be09"
              },
              "legend_categorical_points": {
              "swatch_width": 0.7,
              "swatch_height": 0.75,
              "swatch_radius": 2
              },
              "legend_categorical_map": {
              "swatch_width": 0.7,
              "swatch_height": 0.75,
              "swatch_radius": 2
              },
              "legend_continuous_points": {
              "color_band_height": 3,
              "color_band_radius": 1
              },
              "legend_continuous_map": {
              "color_band_height": 3,
              "color_band_radius": 1
              }
              },
              "bindings": {
                "data": {
                  "label": "date",
                  "value": [
                      "First dose",
                      "Second dose",
                      "Third dose"
                  ],
                }
            },
              "data": {
                data: raw_data
              },
            });

            // latest month
            document.getElementById("latest-month-vaccinations").addEventListener('click', function () {
              var d = new Date();
              var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
              var todayMinusOneMonth = d.getFullYear()+'-'+(d.getMonth())+'-'+(d.getDate()-1);
              my_visualisation.update({
                  state: {
                    "x": {
                      "datetime_max": today,
                      "datetime_min": todayMinusOneMonth
                    },
                    "color": {
                          "categorical_palette": [
                            "#1e558c",
                            "#94d2e6",
                            "#1e8fcc",
                          ],
                    }
                  }
              });
            })

          // last 3 months
          document.getElementById("last-3-months-vaccinations").addEventListener('click', function () {
            var d = new Date();
            var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
            var todayMinusThreeMonths = (d.getFullYear()-1)+'-'+(d.getMonth()+10)+'-'+(d.getDate()-1);
            my_visualisation.update({
                state: {
                  "x": {
                    "datetime_max": today,
                    "datetime_min": todayMinusThreeMonths
                  },
                  "color": {
                          "categorical_palette": [
                            "#1e558c",
                            "#94d2e6",
                            "#1e8fcc",
                          ],
                    }
                }
            });
          }) 

          // last 6 months
          document.getElementById("last-6-months-vaccinations").addEventListener('click', function () {
            var d = new Date();
            var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
            var todayMinusSixMonths = (d.getFullYear()-1)+'-'+(d.getMonth()+7)+'-'+(d.getDate()-1);
            my_visualisation.update({
                state: {
                  "x": {
                    "datetime_max": today,
                    "datetime_min": todayMinusSixMonths
                  },
                  "color": {
                          "categorical_palette": [
                            "#1e558c",
                            "#94d2e6",
                            "#1e8fcc",
                          ],
                    }
                }
            });
          }) 

          // // last year
          // document.getElementById("last-year-vaccinations").addEventListener('click', function () {
          //   var d = new Date();
          //   var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
          //   var todayMinusOneYear = (d.getFullYear()-1)+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
          //   my_visualisation.update({
          //       state: {
          //         "x": {
          //           "datetime_max": today,
          //           "datetime_min": todayMinusOneYear
          //         },
          //         "color": {
          //                 "categorical_palette": [
          //                   "#1e558c",
          //                   "#94d2e6",
          //                   "#1e8fcc",
          //                 ],
          //           }
          //       }
          //   });
          // })

          // all 
          document.getElementById("full-data-vaccinations").addEventListener('click', function () {
            var d = new Date();
            var today = d.getFullYear()+'-'+(d.getMonth()+1)+'-'+(d.getDate()-1);
            my_visualisation.update({
                state: {
                  "x": {
                    "datetime_max": today,
                    "datetime_min": "2021-01-11"
                  },
                  "color": {
                          "categorical_palette": [
                            "#1e558c",
                            "#94d2e6",
                            "#1e8fcc",
                          ],
                    }
                }
            });
          })  

        });

          // covid vacctinations percentage in each groups 
          d3.csv("https://raw.githubusercontent.com/vfillis/automated-covid/main/data/vaccinations-England-ages.csv").then(function(raw_data){
            var my_visualisation = new Flourish.Live({
              "template": "@flourish/line-bar-pie",
              "version": "22.1.0",
              "api_key": "FGCFFotq1s0aECvKcS6rilvdJBCgAHgG-jRUsR9uFznEbEodBBws9Niphbd3z93b",
              "container": "#chartCovidVaccinationsAges",
              "private": false,
              "state": {
                "chart_type": "column_stacked",
                "color": {
                "categorical_palette": [
                "#FE4E36",
                "#FFBAC8",
                "#fff4f0"
                ],
                "sequential_palette": "Custom",
                "sequential_custom_min": "#e0e7f0",
                "sequential_custom_max": "#0d7faf",
                "diverging_palette": "Custom",
                "diverging_custom_min": "#df070a",
                "diverging_custom_max": "#15be09",
                "palette": [
                "#188ce5",
                "#2db757",
                "#ff6d00",
                "#ff4136",
                "#616161",
                "#94346e",
                "#0090a3",
                "#2ed1c6",
                "#6fcc88",
                "#c658c0"
                ]
                },
                "column_opacity": 0.9,
                "column_padding_inner": 9,
                "column_padding_stack": 0,
                "facets": {
                "title_color": null
                },
                "layout": {
                "background_color": "#fdfdfd",
                "body_font": {
                "name": "Roboto Condensed",
                "url": "https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700"
                },
                "footer_note": "Last updated: " + todayFormatted,
                "footer_note_secondary": "<b>Chart credit:</b> Vanessa Fillis <br> Data for England only. ",
                "source_label": "<b>Data source: </b>",
                "source_name": "data.gov.uk",
                "source_url": "https://coronavirus.data.gov.uk/",
                "subtitle_font": {
                "name": "Source Sans Pro",
                "url": "https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700"
                },
                "border": {
                "enabled": false,
                "top": {
                "width": 3,
                "color": "#686868"
                },
                "right": {
                "width": 0
                },
                "bottom": {
                "width": 0
                },
                "left": {
                "width": 0
                }
                },
                "font_color": "#404040",
                "title_size": "custom",
                "title_size_custom": 1.5,
                "subtitle_size": "custom",
                "subtitle_size_custom": 1.25,
                "header_text_size": "custom",
                "header_text_size_custom": 1.1,
                "header_text_line_height": 1.15,
                "footer_text_size": 0.9,
                "footer_logo_height": 2
                },
                "legend_categorical": {
                "order_override": "No vaccine\nFirst dose only\nTwo doses\n",
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "number_format": {
                  "suffix": "%"
                },
                "y": {
                "gridline_category_dividers": false,
                "gridline_color": "#ffffff",
                "gridlines_styling": true,
                "gridline_style": "dot_dash",
                "linear_max": 100,
                "linear_min": 0,
                "tick_label_color": "#777777"
                },
                "legend_continuous": {
                "color_band_height": 3,
                "color_band_radius": 1
                },
                "colors": {
                "sequential_palette": "Custom",
                "sequential_custom_min": "#e0e7f0",
                "sequential_custom_max": "#0d7faf",
                "diverging_palette": "Custom",
                "diverging_custom_min": "#df070a",
                "diverging_custom_max": "#15be09"
                },
                "legend_categorical_points": {
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "legend_categorical_map": {
                "swatch_width": 0.7,
                "swatch_height": 0.75,
                "swatch_radius": 2
                },
                "legend_continuous_points": {
                "color_band_height": 3,
                "color_band_radius": 1
                },
                "legend_continuous_map": {
                "color_band_height": 3,
                "color_band_radius": 1
                },
                "x": {
                "tick_label_color": "#777777"
                }
                },
                "bindings": {
                  "data": {
                    "label": "age",
                    "value": [
                        "Two doses",
                        "First dose only",
                        "No vaccine"
                    ],
                  }
                },
                "data": {
                  data: raw_data
                },
            });
          });
            
          // case rate table 
          
          // vaccination uptake in age groups 

      </script>

    </body>
</html>